<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>FileOutputSourceWriter.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">combiner-maven-plugin</a> &gt; <a href="index.source.html" class="el_package">com.github.jasonmfehr.combiner.output</a> &gt; <span class="el_source">FileOutputSourceWriter.java</span></div><h1>FileOutputSourceWriter.java</h1><pre class="source lang-java linenums">package com.github.jasonmfehr.combiner.output;

import java.io.File;
import java.io.IOException;
import java.nio.charset.Charset;
import java.util.Map;

import org.apache.maven.project.MavenProject;
import org.codehaus.plexus.component.annotations.Component;
import org.codehaus.plexus.component.annotations.Requirement;

import com.google.common.io.Files;
import com.github.jasonmfehr.combiner.logging.ParameterizedLogger;
import com.github.jasonmfehr.tojs.exception.DirectoryCreationException;
import com.github.jasonmfehr.tojs.exception.FileCreationException;
import com.github.jasonmfehr.tojs.exception.FileExistsException;
import com.github.jasonmfehr.tojs.exception.FileWriteException;
import com.github.jasonmfehr.tojs.exception.NotWriteableException;

@Component(role=FileOutputSourceWriter.class)
<span class="fc" id="L21">public class FileOutputSourceWriter implements OutputSourceWriter {</span>
	
	@Requirement
	private ParameterizedLogger logger;

	//TODO the unit tests for this method never assert that the correct fullOutputDestination is created
	public void write(final String encoding, final String outputDestination, final String combinedResources, final Map&lt;String, String&gt; settings, final MavenProject mavenProject) {
		final Charset charSet;
		final File outputFile;
		final String fullOutputDestination;
		
<span class="fc" id="L32">		fullOutputDestination = mavenProject.getBuild().getDirectory() + &quot;/&quot; + outputDestination;</span>
<span class="fc" id="L33">		this.logger.debugWithParams(&quot;{0} starting execution with charset {1} and output destination {2}&quot;, this.getClass().getName(), encoding, fullOutputDestination);</span>
		
<span class="fc" id="L35">		charSet = this.buildCharset(encoding);</span>
<span class="fc" id="L36">		outputFile = this.createOutputFile(fullOutputDestination);</span>
		
<span class="fc" id="L38">		this.writeParsedContents(outputFile, charSet, combinedResources);</span>
<span class="fc" id="L39">	}</span>
	
	private void writeParsedContents(final File outputFile, final Charset charSet, final String contents) {
		try{
<span class="fc" id="L43">			Files.write(contents, outputFile, charSet);</span>
<span class="nc" id="L44">		}catch(IOException e){</span>
<span class="nc" id="L45">			throw new FileWriteException(outputFile.getPath(), e);</span>
<span class="fc" id="L46">		}</span>
<span class="fc" id="L47">	}</span>
	
	private File createOutputFile(final String outputFilePath) {
		final File outputFile;
		final File parentFile;
		
<span class="fc" id="L53">		outputFile = new File(outputFilePath);</span>
		
		//create the directory structure (if it does not exist) where the 
		//output file will reside
<span class="fc" id="L57">		parentFile = outputFile.getParentFile();</span>
<span class="fc bfc" id="L58" title="All 4 branches covered.">		if(!parentFile.exists() &amp;&amp; !parentFile.mkdirs()){</span>
<span class="fc" id="L59">			throw new DirectoryCreationException(outputFile.getParentFile().getPath());</span>
		}
		
		//ensure the output file's containing directory is writeable
<span class="fc bfc" id="L63" title="All 2 branches covered.">		if(!outputFile.getParentFile().canWrite()){</span>
<span class="fc" id="L64">			throw new NotWriteableException(outputFilePath);</span>
		}
		
		//last but not least actually create the file
		try{
<span class="fc bfc" id="L69" title="All 2 branches covered.">			if(!outputFile.createNewFile()){</span>
				//file already exists, throw an exception since we do not want to overwrite anything
<span class="fc" id="L71">				throw new FileExistsException(outputFilePath);</span>
			}
<span class="nc" id="L73">		}catch(IOException ioe){</span>
<span class="nc" id="L74">			throw new FileCreationException(outputFilePath, ioe);</span>
<span class="fc" id="L75">		}</span>
		
<span class="fc" id="L77">		return outputFile;</span>
	}
	
	private Charset buildCharset(final String fileEncoding) {
		final Charset cs;
		
<span class="fc" id="L83">		cs = Charset.forName(fileEncoding);</span>
<span class="fc" id="L84">		this.logger.infoWithParams(&quot;{0} using charset {1} to read files&quot;, this.getClass().getSimpleName(), cs.displayName());</span>
		
<span class="fc" id="L86">		return cs;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>